---
title: "delineateWatershed_all_points"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}

library(tidyverse)
library(progressr)
library(terrainr)
library(readr)
library(devtools)
devtools::install_github("markwh/streamstats")
library(streamstats)


```

Import Data

```{r}

AllWatersheds_LatLong <- read_csv("AllWatersheds_LatLong.csv")

AllWatersheds_LatLong <- AllWatersheds_LatLong %>%
  mutate(Unique_Site_ID = paste0(LTER, "_", Stream.Site)) 

AllWatersheds_LatLong$Unique_Site_ID <- as.factor(AllWatersheds_LatLong$Unique_Site_ID)

AllWatersheds_LatLong %>% group_by(Unique_Site_ID)


```

## Sucessful points

```{r}


AND_GSMACK <- delineateWatershed(xlocation = -122.17282, ylocation = 44.22054, crs = 4326,
includeparameters = "true")

AND_GSMACK_params <- AND_GSMACK$parameters

AND_GSMACK_params <- AND_GSMACK_params %>% mutate(Unique_site_id = "AND_GSMACK")
#Cool map!
map_AND_GSMACK <- leafletWatershed(AND_GSMACK)

#Looking at all the available features
features_AND_GSMACK <- pullFeatureCollection(AND_GSMACK)

#Convert watershed to sp
# Returns either SpatialPointsDataFrame or SpatialPolygonsDataFrame

sp_AND_GSMACK <- toSp(AND_GSMACK)

shp_AND_GSMACK <- writeShapefile(AND_GSMACK, layer = "AND_GSMACK")



```

```{r}


AND_GSWS06 <- delineateWatershed(xlocation = -122.18071, ylocation = 44.26151, crs = 4326,
includeparameters = "true")

AND_GSWS06_params <- AND_GSWS06$parameters

AND_GSWS06_params <- AND_GSWS06_params %>% mutate(Unique_site_id = "AND_GSWS06")
#Cool map!
map_AND_GSWS06 <- leafletWatershed(AND_GSWS06)

#Looking at all the available features
features_AND_GSWS06 <- pullFeatureCollection(AND_GSWS06)

#Convert watershed to sp
# Returns either SpatialPointsDataFrame or SpatialPolygonsDataFrame

sp_AND_GSWS06 <- toSp(AND_GSWS06)

shp_AND_GSWS06 <- writeShapefile(AND_GSWS06, layer = "AND_GSWS06")



```



```{r}

AND_GSWS02 <- delineateWatershed(xlocation = -122.17282, ylocation = 44.22054, crs = 4326,
includeparameters = "true")

AND_GSWS02_params <- AND_GSWS02$parameters

AND_GSWS02_params <- AND_GSWS02_params %>% mutate(Unique_site_id = "AND_GSWS02")


```



```{r}


AND_GSWS07 <- delineateWatershed(xlocation = -122.17526, ylocation = 44.26464, crs = 4326,
includeparameters = "true")

AND_GSWS07_params <- AND_GSWS07$parameters

AND_GSWS07_params <- AND_GSWS07_params %>% mutate(Unique_site_id = "AND_GSWS07")


```

```{r}


AND_GSWS08 <- delineateWatershed(xlocation = -122.17079, ylocation = 44.26629, crs = 4326,
includeparameters = "true")

AND_GSWS08_params <- AND_GSWS08$parameters

AND_GSWS08_params <- AND_GSWS08_params %>% mutate(Unique_site_id = "AND_GSWS08")


```



```{r}


AND_GSWS09 <- delineateWatershed(xlocation = -122.25880, ylocation = 44.20119, crs = 4326,
includeparameters = "true")

AND_GSWS09_params <- AND_GSWS09$parameters

AND_GSWS09_params <- AND_GSWS09_params %>% mutate(Unique_site_id = "AND_GSWS09")


```


## UMR

```{r}

#UMR_BK01.0M is the real unique id but I replaced the "." with a "_"

UMR_BK01_0M <- delineateWatershed(xlocation = -91.25103, ylocation = 43.84128, crs = 4326,
includeparameters = "true", rcode = "WI")

UMR_BK01_0M_params <- UMR_BK01_0M$parameters

UMR_BK01_0M_params <- UMR_BK01_0M_params %>% mutate(Unique_site_id = "UMR_BK01.0M")


```

## Too big! Have to use web app to delineate watershed. Too big regardless of if I use Wisconsin or Minnesota
```{r}


UMR_CH00.1M <- delineateWatershed(xlocation = -92.08417, ylocation = 44.4102, crs = 4326,
includeparameters = "true", rcode = "WI")

UMR_CH00.1M_params <- UMR_CH00.1M$parameters

UMR_CH00.1M_params <- UMR_CH00.1M_params %>% mutate(Unique_site_id = "UMR_CH00.1M")


```

This watershed is also huge but it works. When I use the web app it works for Minnesota but not Wisconsin.

```{r}


	
UMR_CN00.1M <- delineateWatershed(xlocation = -92.59353, ylocation = 44.60340, crs = 4326,
includeparameters = "true", rcode = "MN")

	
UMR_CN00.1M_params <- UMR_CN00.1M$parameters

	
UMR_CN00.1M_params <- UMR_CN00.1M_params %>% mutate(Unique_site_id = "UMR_CN00.1M")


```

Missouri works but Illinois does not

```{r}


	
UMR_CU11.6M <- delineateWatershed(xlocation = -90.74888, ylocation = 38.92419, crs = 4326,
includeparameters = "true", rcode = "MO")

	
UMR_CU11.6M_params <- UMR_CU11.6M$parameters

	
UMR_CU11.6M_params <- UMR_CU11.6M_params %>% mutate(Unique_site_id = "UMR_CU11.6M")


```

When you specify Illinois on the web app it shows you the nice blue lines to pick from but it does not actually let you select any points within the Illinois River

```{r}


UMR_I080.2M <- delineateWatershed(xlocation = -90.53346, ylocation = 39.93919, crs = 4326,
includeparameters = "true", rcode = "IL")

	
UMR_I080.2M_params <- UMR_I080.2M$parameters

	
UMR_I080.2M_params <- UMR_I080.2M_params %>% mutate(Unique_site_id = "UMR_I080.2M")


```

When you specify Illinois it works on the web app but times out here in R (Error in curl::curl_fetch_memory(url, handle = handle) : Timeout was reached: [streamstats.usgs.gov] Operation timed out after 60002 milliseconds with 0 bytes received)

```{r}


UMR_LM00.5M <- delineateWatershed(xlocation = -90.52039, ylocation = 39.98828, crs = 4326,
includeparameters = "true", rcode = "IL")

	
UMR_LM00.5M_params <- UMR_LM00.5M$parameters

	
UMR_LM00.5M_params <- UMR_LM00.5M_params %>% mutate(Unique_site_id = "UMR_LM00.5M")


```


For this one Missouri works on the web app but the watershed is a super small area. Worth double checking on the web app to make sure this looks correct to the working group

```{r}


UMR_M078.0B <- delineateWatershed(xlocation = -89.51206, ylocation = 37.60460, crs = 4326,
includeparameters = "true", rcode = "MO")

	
UMR_M078.0B_params <- UMR_M078.0B$parameters

UMR_M078.0B_params <- UMR_M078.0B_params %>% mutate(Unique_site_id = "UMR_M078.0B")


```





This one is interesting. The function funs with either MO ir IL but the point does appear to be on the IL side of the boundary. The watershed boundaries look wildly different on the web app depending on if you select the IL or MO side of the river.

```{r}


UMR_M241.4K <- delineateWatershed(xlocation = -90.68312, ylocation = 39.00474, crs = 4326,
includeparameters = "true", rcode = "IL")

	
UMR_M241.4K_params <- UMR_M241.4K$parameters

UMR_M241.4K_params <- UMR_M241.4K_params %>% mutate(Unique_site_id = "UMR_M241.4K")


```
Iowa works for this one but not Illinois

```{r}


UMR_M556.4A <- delineateWatershed(xlocation = -90.42071, ylocation = 42.25474, crs = 4326,
includeparameters = "true", rcode = "IA")

	
UMR_M556.4A_params <- UMR_M556.4A$parameters

UMR_M556.4A_params <- UMR_M556.4A_params %>% mutate(Unique_site_id = "UMR_M556.4A")


```

Minnesota works 

```{r}


UMR_M701.1B<- delineateWatershed(xlocation = -91.29378, ylocation = 43.84932, crs = 4326,
includeparameters = "true", rcode = "MN")

	
UMR_M701.1B_params <- UMR_M701.1B$parameters

UMR_M701.1B_params <- UMR_M701.1B_params %>% mutate(Unique_site_id = "UMR_M701.1B")


```

Works with Wisconsin

```{r}


	
UMR_M764.3A <- delineateWatershed(xlocation = -92.10064, ylocation = 44.41197, crs = 4326,
includeparameters = "true", rcode = "WI")

	
UMR_M764.3A_params <- UMR_M764.3A$parameters

UMR_M764.3A_params <- UMR_M764.3A_params %>% mutate(Unique_site_id = "UMR_M764.3A")


```


Works with Minnesota on the web app but too big for the R function

```{r}

	
UMR_M786.2C <- delineateWatershed(xlocation = -92.44935, ylocation = 44.56224, crs = 4326,
includeparameters = "true", rcode = "MN")

	
UMR_M786.2C_params <- UMR_M786.2C$parameters

UMR_M786.2C_params <- UMR_M786.2C_params %>% mutate(Unique_site_id = "UMR_M786.2C")


```

Iowa works on the web app but it is too big for the R function

```{r}

	
UMR_MQ02.1M <- delineateWatershed(xlocation = -90.33544, ylocation = 42.16381, crs = 4326,
includeparameters = "true", rcode = "IA")

	
UMR_MQ02.1M_params <- UMR_MQ02.1M$parameters

UMR_MQ02.1M_params <- UMR_MQ02.1M_params %>% mutate(Unique_site_id = "UMR_MQ02.1M")


```

If you view this point on the web app youll see it appears to be directly between two different bodies of water. Working group may want to double check we select the correct one within Illinois 

```{r}

	
UMR_SG16.2C <- delineateWatershed(xlocation = -90.14657, ylocation = 40.06443, crs = 4326,
includeparameters = "true", rcode = "IL")

	
UMR_SG16.2C_params <- UMR_SG16.2C$parameters

UMR_SG16.2C_params <- UMR_SG16.2C_params %>% mutate(Unique_site_id = "UMR_SG16.2C")


```


Iowa works on the web app but is too big to be run in the function


```{r}

	
UMR_WP02.6M <- delineateWatershed(xlocation = -90.35971, ylocation = 41.72764, crs = 4326,
includeparameters = "true", rcode = "IA")

	
UMR_WP02.6M_params <- UMR_WP02.6M$parameters

UMR_WP02.6M_params <- UMR_WP02.6M_params %>% mutate(Unique_site_id = "UMR_WP02.6M")


```


## AND

Oregon works really nicely for this one
```{r}

	
AND_GSMACK <- delineateWatershed(xlocation = -122.17282, ylocation = 44.22054, crs = 4326,
includeparameters = "true", rcode = "OR")

	
AND_GSMACK_params <- AND_GSMACK$parameters

AND_GSMACK_params <- AND_GSMACK_params %>% mutate(Unique_site_id = "AND_GSMACK")


```

Oregon also works well here
```{r}

	
AND_GSWS02 <- delineateWatershed(xlocation = -122.24488, ylocation = 44.21202, crs = 4326,
includeparameters = "true", rcode = "OR")

	
AND_GSWS02_params <- AND_GSWS02$parameters

AND_GSWS02_params <- AND_GSWS02_params %>% mutate(Unique_site_id = "AND_GSWS02")


```

```{r}

	
AND_GSWS06 <- delineateWatershed(xlocation = -122.18071, ylocation = 44.26151, crs = 4326,
includeparameters = "true", rcode = "OR")

	
AND_GSWS06_params <- AND_GSWS06$parameters

AND_GSWS06_params <- AND_GSWS06_params %>% mutate(Unique_site_id = "AND_GSWS06")


```



```{r}

	
AND_GSWS010 <- delineateWatershed(xlocation = -122.26106, ylocation = 44.21706, crs = 4326,
includeparameters = "true", rcode = "OR")

	
AND_GSWS010_params <- AND_GSWS010$parameters

AND_GSWS010_params <- AND_GSWS010_params %>% mutate(Unique_site_id = "AND_GSWS010")


```



## ARC

On the web app this actually looks like it wants to work. You can select 'Alaska' as a valid state (which obviously it is but we werent sure how USGS dealt with it)

```{r}

	
ARC_Imnavait_Weir <- delineateWatershed(xlocation = -149.31788, ylocation = 68.61701, crs = 4326, includeparameters = "true", rcode = "AK")

	
ARC_Imnavait_Weir_params <- ARC_Imnavait_Weir$parameters

ARC_Imnavait_Weir_params <- ARC_Imnavait_Weir_params %>% mutate(Unique_site_id = "ARC_Imnavait Weir")


```


I gave this one a try too just because it is right next to Toolik Lake so I thought delineation might be easier but it did not work on the web app.

```{r}

	
ARC_TW_Weir <- delineateWatershed(xlocation = -149.61656, ylocation = 68.62349, crs = 4326, includeparameters = "true", rcode = "AK")

	
ARC_TW_Weir_params <- ARC_TW_Weir$parameters

ARC_TW_Weir_params <- ARC_TW_Weir_params %>% mutate(Unique_site_id = "ARC_TW Weir")


```

## HBR

I was hoping Hubbard Brook was all within one state but it does not look like it!

```{r}

	
	
HBR_ws1 <- delineateWatershed(xlocation = -71.72650, ylocation = 43.95203, crs = 4326, includeparameters = "true", rcode = "NH")

	
HBR_ws1_params <- HBR_ws1$parameters

HBR_ws1_params <- 	HBR_ws1_params %>% mutate(Unique_site_id = "HBR_ws1")


```



```{r}

	
	
HBR_ws2 <- delineateWatershed(xlocation = -71.72420, ylocation = 43.95336, crs = 4326, includeparameters = "true", rcode = "NH")

	
HBR_ws2_params <- HBR_ws2$parameters

HBR_ws2_params <- 	HBR_ws2_params %>% mutate(Unique_site_id = "HBR_ws2")


```


```{r}


HBR_ws3 <- delineateWatershed(xlocation = -71.72280, ylocation = 43.95487, crs = 4326, includeparameters = "true", rcode = "NH")

	
HBR_ws3_params <- HBR_ws3$parameters

HBR_ws3_params <- 	HBR_ws3_params %>% mutate(Unique_site_id = "HBR_ws3")


```



```{r}

	
HBR_ws4 <- delineateWatershed(xlocation = -71.72580, ylocation = 43.95018, crs = 4326, includeparameters = "true", rcode = "NH")

	
HBR_ws4_params <- HBR_ws4$parameters

HBR_ws4_params <- 	HBR_ws4_params %>% mutate(Unique_site_id = "HBR_ws4")


```

```{r}


HBR_ws5 <- delineateWatershed(xlocation = -71.73190, ylocation = 43.94885, crs = 4326, includeparameters = "true", rcode = "NH")

	
HBR_ws5_params <- HBR_ws5$parameters

HBR_ws5_params <- 	HBR_ws5_params %>% mutate(Unique_site_id = "HBR_ws5")


```

```{r}


HBR_ws6 <- delineateWatershed(xlocation = -71.73560, ylocation = 43.94994, crs = 4326, includeparameters = "true", rcode = "NH")

	
HBR_ws6_params <- HBR_ws6$parameters

HBR_ws6_params <- 	HBR_ws6_params %>% mutate(Unique_site_id = "HBR_ws6")


```

```{r}


HBR_ws7 <- delineateWatershed(xlocation = -71.76710, ylocation = 43.92751, crs = 4326, includeparameters = "true", rcode = "NH")

	
HBR_ws7_params <- HBR_ws7$parameters

HBR_ws7_params <- 	HBR_ws7_params %>% mutate(Unique_site_id = "HBR_ws7")


```

```{r}


HBR_ws8 <- delineateWatershed(xlocation = -71.75950, ylocation = 43.92944, crs = 4326, includeparameters = "true", rcode = "NH")

	
HBR_ws8_params <- HBR_ws8$parameters

HBR_ws8_params <- 	HBR_ws8_params %>% mutate(Unique_site_id = "HBR_ws8")


```

```{r}


HBR_ws9 <- delineateWatershed(xlocation = -71.74720, ylocation = 43.92601, crs = 4326, includeparameters = "true", rcode = "NH")

	
HBR_ws9_params <- HBR_ws9$parameters

HBR_ws9_params <- 	HBR_ws9_params %>% mutate(Unique_site_id = "HBR_ws9")


```